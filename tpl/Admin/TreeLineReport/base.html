<extend name="Public:base"/><block name="title">树障详情</block>
<block name="content">
<div class="col-xs-12">
    <div class="tabbable">
    <table class="table table-striped table-bordered table-hover table-condensed">

        <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
         <li >
         <a href="/ts/index.php/Admin/Tree/index/group_id/{$group_id}" >树障列表</a></li>

        <li class="active">  <a href="javascript:;" data-toggle="tab">树障详情</a></li>
        <li>  <a href="/ts/index.php/Admin/TreeDetail/index/tid/{$tid}" >巡检记录</a></li>
        <li>  <a href="/ts/index.php/Admin/TreeProcess/index/tid/{$tid}" >处理记录</a></li>
        <!-- <li>  <a href="/ts/index.php/Admin/TreeFly/index/group_id/{$group_id}/tid/{$tid}" >飞行记录</a></li> -->
        
           <!-- <li>
          <a href="/ts/index.php/Admin/Tree/add/group_id/{$group_id}"  >增加树障</a></li> -->
      </ul>
        <tr>
          <td>
            
            
           

               <a href="" style="width:10%" id="list_button" tid="{$tid}" class="btn btn-sm disabled"  >树障信息</a>


              <!--   <li class="dropdown btn btn-sm btn-success" style="width:10%">
                <a href="javascript:;" style="color:#FFFFFF" class="dropdown-toggle" data-toggle="dropdown">
                    修改或更新
                    <b class="caret"></b>
                </a>
                <ul class="dropdown-menu"   style="z-index:9999;">
                  
                  
                    <li><a href="javascript:;" tid="{$tid}" line_id="{line_id}"  onclick="edit_tree(this);">修改基础信息</a></li>
                    <li><a href="javascript:;" tid="{$tid}"  onclick="add_detail(this);">更新巡检记录</a></li>

                   

                   

                </ul>
            </li> -->




              
               <input style="width:10%" id="edit_button" class="btn btn-sm btn-success"  type="button"   tid="{$tid}" line_id="{line_id}" onclick="edit_tree(this)" value="
               修改基本数据">
               <input style="width:10%" id="update_button" class="btn btn-sm btn-success"  type="button"   tid="{$tid}" onclick="add_detail(this)" value="
               更新巡检记录">
            
              <!--  <input style="width:6%" class="btn btn-sm btn-success" type="button" onclick="" value="树障归档"> -->
               <input style="width:10%" class="btn btn-sm btn-danger" type="button" tid="{$tid}"  onclick="delete_tree(this)" onclick="" value="删除树障">
           


        
          </td>
        </tr>
      </table>
     
      
     

 <div id="tree-base-content">

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
    <div class="navbar-header">
        <a class="navbar-brand" href="#"><font size="2">树障当前流程：</font></a>
    </div>
    <div>
        <ul class="nav navbar-nav">
            <li class="active"><a href="#"><font size="2" color="red">{$data[0]['tree_div']}</font></a></li>
           
            <li class="dropdown" >
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                   更改
                    <b class="caret"></b>
                </a>
              
                <ul class="dropdown-menu" >
                  
                    <li class="divider"></li>
                    <li><a href="javascript:;" tid="{$tid}"  onclick="edit_order(this);">更改当前流程</a></li>

                </ul>
               
            </li>
        </ul>
    </div>
    </div>
</nav>

 
  <br/>
  <br/>



 <table class="table table-striped table-bordered table-hover table-condensed" >
            <foreach name="data" item="v">
              <tr>
                <th  colspan="25"><font size="2" color="red">隐患基本信息</font></th>
              </tr>
                <tr>
                    <th colspan="4">隐患单位</th>
                    <th colspan="3">隐患所属点</th>
                    <th colspan="5">隐患所处位置</th>
                    <th colspan="13">隐患总体量</th>
                </tr>
                <tr>
                    <th colspan="1">运行单位</th>
                    <th colspan="1">序号</th>
                    <th colspan="1">责任班组</th>
                    <th colspan="1">巡视段责任人</th>
                    <th colspan="1">县</th>
                    <th colspan="1">镇</th>
                    <th colspan="1">村</th>
                    <th colspan="1">电压等级（KV）</th>
                    <th colspan="1">线路名称</th>
                    <th colspan="1">小号杆</th>
                    <th colspan="1">大号杆（</th>
                    <th colspan="1">隐患序号</th>
                    <th colspan="1">首次调查人</th>
                    <th colspan="1">首次隐患调查日期</th>
                    <th colspan="1">首次上报日期</th>
                    <th colspan="1">树障存在的状态</th>
                    <th colspan="1">树障种类</th>
                    <th colspan="1">保护区范围外是否有需要处理的树障</th>
                    <th colspan="1">需处理的隐患树障数量</th>
                    <th colspan="1">需处理的隐患树障数量单位</th>
                    <th colspan="1">隐患树障数量</th>
                    <th colspan="1">需处理的隐患树障数量单位</th>
                    <th colspan="1">需处理的隐患树障树高</th>
                    <th colspan="1">需处理的隐患树木胸径范围</th>
                    <th colspan="1">树木平均高度</th>
                </tr>
                    <tr>
                      <td  >{$v['accountability_department']}</td>
                      <td  >{$v['accountability_number']}</td> 
                      <td  >{$v['accountability_group']}</td>
                      <td  >{$v['accountability_person']}</td>
                      <td  >{$v['county']}</td>
                      <td  >{$v['town']}</td>                      
                      <td  >{$v['village']}</td>
                      <td  >{$v['voltage_degree']}kV</td>                       
                      <td  >{$v['voltage_degree']}kV{$v['device_name']}</td> 
                      <td  >{$v['star_tower']}</td>
                      <td  >{$v['end_tower']}</td>
                      <td  >{$v['danger_num']}</td>
                      <td  >{$v['first_check_person']}</td>
                      <td  >{$v['first_check_time']|date='Y-m-d',###}</td>              
                      <td  >{$v['first_upload_time']|date='Y-m-d',###}</td>              
                      <td  >{$v['tree_status']}</td>
                      <td  >{$v['tree_type']}</td>    
                      <td  ><if condition="$v['tree_danger'] eq '1'">是
                            <else /> 否
                            </if></td>                     
                        <td  >{$v['tree_danger_num']}</td>
                        <td  >{$v['tree_danger_num_unit']}</td>
                        <td  >{$v['tree_danger_area']}</td>
                        <td  >{$v['tree_danger_area_unit']}</td> 
                        <td  >{$v['tree_danger_height']}</td> 
                        <td  >{$v['average_radius']}</td>
                        <td  >{$v['average_height']}</td>
                    </tr> 
                    </table>
                    <br/>
                    <br/>
                  
                   <table class="table table-striped table-bordered table-hover table-condensed" >

                    <tr>
                        <th colspan="26"><font size="2" color="red">隐患最新信息</font></th>
                      </tr>    
                    <tr>
                        <th colspan="7">隐患最新情况</th>
                        <th colspan="3">隐患最新情况（程度）</th>
                        <th colspan="1">隐患最新情况（位置）</th>
                        <th colspan="11">隐患最新情况（表象）</th>
                        <th colspan="3">隐患最新情况（监测）</th> 
                        <th colspan="1">隐患来源</th>                
 
                    </tr>
                    <tr>
                    <th colspan="1">最新隐患调查日期）</th>
                    <th colspan="1">最新隐患调查人</th>
                    <th colspan="1">测量时刻</th>
                    <th colspan="1">树木按地点属性</th>
                    <th colspan="1">是否新种、新移栽</th>
                    <th colspan="1">是否临近重大、一般缺陷</th>
                    <th colspan="1">是否会翻生</th>
                    <th colspan="1">隐患级别</th>
                    <th colspan="1">级别变化</th>
                    <th colspan="1">处理结论</th>                
                    <th colspan="1">位置结论</th>
                    <!-- <th colspan="1">最危急树障相对杆塔、线路位置，距离弧垂点或导线近地点位置等描述。如距离#x杆塔x米处、弧垂点。。。</th>（也就是测量结论(位置)） -->
                    <th colspan="1">最危急树障种类</th>
                    <th colspan="1">最危急树障数量</th>
                    <th colspan="1">最危急树障数量单位</th>
                    <th colspan="1">最危急树障面积</th>
                    <th colspan="1">最危急树障面积单位</th>
                    <th colspan="1">最危急树障树高</th>
                    <th colspan="1">最危急树障导线对树木水平距离</th>
                    <th colspan="1">最危急树障导线对树木垂直距离</th>
                    <th colspan="1">最危急树障导线对地距离</th>
                    <th colspan="1">是否高出导线</th>
                    <th colspan="1">最终自然生长高度是否构成紧急级别隐患</th> 
                    <th colspan="1">测量方法</th> 
                    <th colspan="1">气温（℃）</th> 
                    <th colspan="1">负荷（A）</th> 
                    <th colspan="1">是否建设遗留</th> 
                </tr>
                        <td  >{$v['detail_last_time']|date='Y-m-d',###}</td>                                                 
                        <td  >{$v['datail_check_person']}</td> 
                        <td  id="t-datail_check_time">{$v['datail_check_time']|date='Y-m-d H:i:s',###}</td>
                        
                        <td  id="t-tree_property">{$v['tree_property']}</td>                        
                        <td  id="t-new_plant">{$v['new_plant']}</td>
                        <td  id="t-defect_type">{$v['defect_type']}</td>                        
                        <td  id="t-survival">{$v['survival']}</td>
                        
                        <td  id="t-datail_danger_degree">{$v['datail_danger_degree']}</td>                        
                        <td  id="t-datail_check_change_conclusion">{$v['datail_check_change_conclusion']}</td>
                        <td  id="t-datail_check_process_conclusion">{$v['datail_check_process_conclusion']}</td>                        
                        <td  id="t-datail_check_posistion_conclusion">{$v['datail_check_posistion_conclusion']}</td>
                        <td  id="t-datail_tree_type">{$v['datail_tree_type']}</td>
                        <td  id="t-datail_tree_num">{$v['datail_tree_num']}</td>
                        <td  id="t-datail_tree_num_unit">{$v['datail_tree_num_unit']}</td>
                        <td  id="t-datail_tree_area">{$v['datail_tree_area']}</td>
                        <td  id="t-datail_tree_area_unit">{$v['datail_tree_area_unit']}</td>
                        <td  id="t-datail_tree_height">{$v['datail_tree_height']}</td>                        
                        <td  id="t-datail_tree_horizontal">{$v['datail_tree_horizontal']}</td>
                        <td  id="t-datail_tree_vertical">{$v['datail_tree_vertical']}</td>
                        <td  id="t-datail_tree_grand_height">{$v['datail_tree_grand_height']}</td>
                        <td  id="t-datail_tree_over">
                            <if condition="$v['datail_tree_over'] eq '1'">是
                                <else /> 否
                                    </if>
                        </td>
                        <td  id="t-datail_final_danger">
                            <if condition="$v['datail_final_danger'] eq '1'">是
                            <else /> 否
                                </if>
                        </td> 
                         
                        <td  >{$v['detail_check_method']}</td>
                        <td  >{$v['detail_temperature']}</td>
                        <td  >{$v['detail_load']}</td>

                        <td  ><if condition="$v['detail_retain'] eq '1'">是
                          <else /> 否
                          </if></td>  

                     
                    </tr>
                    <tr>
                        <th colspan="4">隐患权属人信息</th>
                        <th colspan="5">隐患处理与管控</th>                
                        <th colspan="5">系统新增</th> 
                    </tr>
                    <tr>
                        <th colspan="1">种植物联系人地址</th>  
                        <th colspan="1">种植物联系人姓名</th> 
                        <th colspan="1">种植物联系人电话</th> 
                        <th colspan="1">种植时间</th>
                        <th colspan="1">青赔情况</th>  
                        <th colspan="1">协议签定情况</th> 
                        <th colspan="1">运行过程中协议情况</th> 
                        <th colspan="1">隐患通知书编号、情况</th>
                        <th colspan="1">任务单发布时间</th>
                        <th colspan="1">更新时间</th>
                        <th colspan="1">更新人</th>                                 
                        <th colspan="1">更新班组</th>                 
                        <th colspan="1">截止时间</th> 
                        <th colspan="1">是否处理</th>     
                    </tr>
                    <tr>
                        <td  >{$v['detail_address']}</td>
                        <td  >{$v['detail_owner']}</td>
                        <td  >{$v['detail_phone']}</td>
                        <td  >{$v['detail_plant_time']}</td>
                        <td  >{$v['detail_compensation_condition']}</td> 
                        <td  >{$v['detail_build_deal']}</td>
                      <td  >{$v['detail_run_deal']}</td>
                      <td  >{$v['detail_notice_number']}</td>
                      <td  >{$v['detail_order_time']}</td>
                      <td  >{$v['datail_update_time']|date='Y-m-d',###}</td>
                      <td  id="t-datail_update_person">{$v['datail_update_person']}</td>                     
                      <td  id="t-datail_update_group">{$v['datail_update_group']}</td> 
                      <td  >{$v['dead_line_time']|date='Y-m-d',###}</td>                        
                      <td >
                              <if condition="$v['processed'] eq '1'">是
                              <else /> 否
                              </if>
                              </td>
                    </tr>
                </foreach>        
    </table>
    </div>

      
    </div>

      <div class="modal fade" id="bjy-edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="myModalLabel">修改树障当前流程</h4></div>
        <div class="modal-body">
          <form id="bjy-form" class="form-inline" action="{:U('Admin/TreeOrder/edit_tree_div')}" method="post">
            <input type="hidden" name="tid">
            <table class="table table-striped table-bordered table-hover table-condensed">
             
              <tr>
                <th width="12%">树障当前流程</th>
                <td>
                 <input style="width:80%;" type="text" name="tree_div" id="tree_div" />
              </tr>
             
              <tr>
                <th></th>
                <td>
                  <input class="btn btn-success" type="submit" value="确定"></td>
              </tr>
            </table>
          </form>
        </div>
      </div>
    </div>
  </div>
</block>



</block>



<block name="js">
   <script>
       function add_detail(obj)
    {

       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/ts/index.php/Admin/TreeDetail/add",
           data:{
              tid:tid
             },
             success:function(msg){


          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");
          $("#edit_button").removeClass("disabled");
          $("#edit_button").addClass("btn-success");
          $("#update_button").removeClass("btn-success");
          $("#update_button").addClass("disabled");
    
            $("#tree-base-content").html(msg);
          
          
            },
            error:function(XMLHttpRequest, textStatus, thrownError){}
          })
    }

       function edit_order(obj) {
      var tid = $(obj).attr('tid');
    
      $("input[name='tid']").val(tid);
    
      $('#bjy-edit').modal('show');
    }

   function delete_tree(obj)
     {
       if(confirm('确定删除？'))
       {
           var tid=$(obj).attr('tid');
          
           $.ajax({
           url:'/ts/index.php/Admin/Tree/delete',
           type:'GET', 
           async:true,    
           data:{
              tid:tid
           },
            success:function(msg)
            {
             
            if(msg.status==0)
            {
               alert(msg.info);
            }else
            {
               alert('删除成功');
               location.reload();
            }
          
           },
          

       })
          
       }
     }
      function edit_tree(obj) {
     
      $.ajax({
      type:"GET",
      url:"/ts/index.php/Admin/Tree/edit",
      data:{
      
        edit_line_id:$(obj).attr('line_id'),
       // group_id:{$group_id},
        edit_tid:$(obj).attr('tid'),
        edit_index:1
          },
      success:function(msg){

          $("#tree-base-content").html(msg);
          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");
          $("#update_button").removeClass("disabled");
          $("#update_button").addClass("btn-success");
          $("#edit_button").removeClass("btn-success");
          $("#edit_button").addClass("disabled");

        },
      error:function(XMLHttpRequest, textStatus, thrownError)
      {
            
      } 
      });
  
    }
  </script>
   <script type="text/javascript">
    $(document).ready(function()
    {      
      console.log({$data})
});
</script>
</block>
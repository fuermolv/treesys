<extend name="Public:base"/><block name="title">树木列表</block>
<block name="content">
<div class="col-xs-12">
    <div class="tabbable">
    <table class="table table-striped table-bordered table-hover table-condensed">

       <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
        <li class="active">
          <a href="javascript:;" data-toggle="tab">按钮1</a></li>
        <li>
          <a href="javascript:;" ">按钮2</a></li>
      </ul>
        <tr>
          <td>
            <form class="form-inline" action="" id="my_form" >
            
            <select style="width:8%" name="line_id" id="line_id" onchange="submitForm();">
            <option value ="">全部线路</option>
            <foreach name="querydata['device_lines']" item="v">
             <option value ="{$v['did']}">{$v['voltage_degree']}kV{$v['device_name']}</option>
            </foreach>
            </select>

            <select style="width:8%" name="voltage_degree" id="voltage_degree" onchange="submitForm();">
            <option value ="" >电压等级</option>
            <option value ="500">500kV</option>
            <option value ="220" >220kV</option>
            <option value="110" >110kV</option>
            <option value="35"  >35kV</option>
            </select>

          

            </select>
            <select style="width:8%" name="county"  id="county" onchange="submitForm();">
            <option value ="">县区</option>
            <option value ="1">清城区</option>
            <option value ="2">清新县</option>
            <option value="3">佛冈县</option>
            <option value="4">英德市</option>
            <option value ="5">阳山县</option>
            <option value ="6">连州市</option>
            <option value ="7">连南县</option>
            <option value="8">连山县</option>
            
            </select>

            <select style="width:8%" name="town"   id="town" onchange="submitForm();">
            <option value ="">镇</option>
            <foreach name="querydata['towns']" item="v">
             <option value ="{$v['id']}">{$v['name']}</option>
            </foreach>
            </select>

            <select style="width:8%" name="village"  id="village" onchange="submitForm();">
            <option value ="">村</option>
            <foreach name="querydata['villages']" item="v">
             <option value ="{$v['id']}">{$v['name']}</option>
             </foreach>
            </select>
            
            截止时间开始<input type="date" value="" name="dead_line_time_begin" id="dead_line_time_begin" onchange="submitForm();">
            截止时间结束<input type="date" value=""  name="dead_line_time_end" id="dead_line_time_end" onchange="submitForm();">

            <select style="width:8%" name="orderBy" id="orderBy" onchange="submitForm();">
            <option value ="">排序方式</option>
            <option value ="danger_degree desc">威胁等级降序</option>
            <option value ="dead_line_time desc">截止时间降序</option>
            <option value ="update_time desc">更新时间降序</option>         
            </select>
           

            <input style="width:6%" type="submit" class="btn btn-sm btn-success"  value="数据筛选">
            </form>
          </td>
        </tr>
      </table>
      <!-- <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">

        <li class="active">
        <a href="javascript:;">按钮1</a>
        </li>
        <li>
         <a href="javascript:;">按钮2</a>
        </li>
        <li>
          <a href="javascript:;">按钮3</a>
         </li>
      </ul> -->
      <div class="tab-content">
        <table class="table table-striped table-bordered table-hover table-condensed">
          <tr>
            <th width="3%">编号</th>
            <th width="3%">线路名称</th>
            <th width="3%">起始杆塔</th>
            <th width="3%">结束杆塔</th>
            <th width="3%">距离垂弧位置</th>
            <th width="3%">威胁等级</th>
            <th width="3%">面积</th>
            <th width="3%">面积单位</th>
            <th width="3%">高度</th>
            <th width="3%">水平距离</th>
            <th width="3%">垂直距离</th>
            <th width="3%">是否高出导线</th> 
            <th width="3%">树种</th>
            <th width="3%">县</th>
            <th width="3%">镇</th>
            <th width="3%">村委会</th>
            <th width="3%">拥有者</th>
            <th width="3%">测量方式</th>
            <th width="4%">测量时间</th>
            <th width="3%">是否处理</th>
            <th width="4%">更新时间</th>
            <th width="4%">截止时间</th>
            
            <th width="10%">操作</th>
            
            </tr>
          <foreach name="data" item="v">
            <tr>
              <td>{$v['tid']}</td>
              <td>{$v['voltage_degree']}kV{$v['device_name']}</td>
              <td>{$v['star_tower']}</td>
              <td>{$v['end_tower']}</td>
              <td>{$v['place']}</td>
              <td>{$v['danger_degree']}</td>
              <td>{$v['area']}</td>
              <td>{$v['area_type']}</td>
              <td>{$v['height']}</td>
              <td>{$v['horizontal']}</td>
              <td>{$v['vertical']}</td>
              <td>
              <if condition="$v['over'] eq 'true'">是
              <else /> 否
              </if>
              </td>
             
              <td>{$v['tree_type']}</td>
              <td>{$v['county']}</td>
              <td>{$v['town']}</td>
              <td>{$v['village']}</td>
              <td>{$v['owner']}</td>
              <td>{$v['measure_way']}</td>
              <td>{$v['measure_time']|date='Y-m-d',###}</td>  
               <td>
               <if condition="$v['processed'] eq 'true'">是
              <else /> 否
              </if>
              </td>
              
              <td>{$v['update_time']|date='Y-m-d',###}</td> 
              <td>{$v['dead_line_time']|date='Y-m-d',###}</td>  

              <td>
              <a href="javascript:;">详情</a>||
              <a href="javascript:;"  tid="{$v['tid']}" onclick="edit_tree(this)">修改</a>||
              <a href="javascript:;"  tid="{$v['tid']}" onclick="delete_tree(this)">删除</a>
              </td>
            </tr>
          </foreach>
        </table>
        <div align="center"> {$pagehtml}</div>
        
      </div>
    </div>
  </div>
  <div class="modal fade" id="bjy-edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
   data-backdrop="static">
    <div class="modal-dialog">
      <div class="modal-content" id="edit-tree-content" style="width:1200px;height:800px;">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="myModalLabel">修改菜单</h4></div>
        <div class="modal-body" >
          <form id="bjy-form" class="form-inline"  action="{:U('Admin/Nav/edit')}" method="post">
            <input type="hidden" name="id">
            <table class="table table-striped table-bordered table-hover table-condensed">
              <tr>
                <th width="12%">菜单名：</th>
                <td>
                  <input class="input-medium" type="text" name="name"></td>
              </tr>
              <tr>
                <th>连接：</th>
                <td>
                  <input class="input-medium" type="text" name="mca">输入模块/控制器/方法即可 例如 Admin/Nav/index</td></tr>
              <tr>
                <th>图标：</th>
                <td>
                  <input class="input-medium" type="text" name="ico">font-awesome图标 输入fa fa- 后边的即可</td></tr>
              <tr>
                <th></th>
                <td>
                  <input class="btn btn-success" type="submit" value="修改"></td>
              </tr>
            </table>
          </form>
        </div>
      </div>
    </div>
  </div>
</block>



<block name="js">
  
  
  
  
    <script>
    function submitForm()
     {
      sessionStorage.setItem("voltage_degree",document.getElementById("voltage_degree").value);
      sessionStorage.setItem("line_id",document.getElementById("line_id").value); 
      sessionStorage.setItem("county",document.getElementById("county").value); 
      sessionStorage.setItem("town",document.getElementById("town").value); 
      sessionStorage.setItem("village",document.getElementById("village").value);  
      sessionStorage.setItem("orderBy",document.getElementById("orderBy").value); 
       sessionStorage.setItem("dead_line_time_begin",document.getElementById("dead_line_time_begin").value); 
        sessionStorage.setItem("dead_line_time_end",document.getElementById("dead_line_time_end").value); 

      var form = document.getElementById("my_form");//获取form表单对象
      form.submit();//form表单提交
     }

       function delete_tree(obj)
     {
       if(confirm('确定删除？'))
       {
           var tid=$(obj).attr('tid');
          
           $.ajax({
           url:'/treesys/index.php/Admin/Line/delete',
           type:'GET', 
           async:true,    
           data:{
              tid:tid
           }})
           submitForm()
       }
     }
     function edit_tree(obj)
     {

         var tid=$(obj).attr('tid');
         document.getElementById("edit-tree-content").style.marginLeft="-50%";
         $('#bjy-edit').modal('show');
     } 

     </script>

    




    <script type="text/javascript">
    $(document).ready(function()
    {
      
      $("#voltage_degree").val(sessionStorage.getItem("voltage_degree"))
      $("#line_id").val(sessionStorage.getItem("line_id"))
      $("#county").val(sessionStorage.getItem("county"))
      $("#town").val(sessionStorage.getItem("town"))
      $("#village").val(sessionStorage.getItem("village"))
      
      $("#orderBy").val(sessionStorage.getItem("orderBy"))
      $("#dead_line_time_begin").val(sessionStorage.getItem("dead_line_time_begin"))
      $("#dead_line_time_end").val(sessionStorage.getItem("dead_line_time_end"))
      
      
    });   
  </script>
</block>
<extend name="Public:base"/><block name="title">树木列表</block>
<block name="content">
<div class="col-xs-12">
    <div class="tabbable">
    <table class="table table-striped table-bordered table-hover table-condensed">

       <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
        <li class="active">
          <a href="javascript:;" data-toggle="tab">按钮1</a></li>
        <li>
          <a href="javascript:;" ">按钮2</a></li>
      </ul>
        <tr>
          <td>
            <form class="form-inline" action="" id="my_form" >
            
            <select style="width:8%" name="line_id" id="line_id" onchange="submitForm();">
            <option value ="">全部线路</option>
            <foreach name="querydata['device_lines']" item="v">
             <option value ="{$v['did']}">{$v['voltage_degree']}kV{$v['device_name']}</option>
            </foreach>
            </select>

            <select style="width:8%" name="voltage_degree" id="voltage_degree" onchange="submitForm();">
            <option value ="" >电压等级</option>
            <option value ="500">500kV</option>
            <option value ="220" >220kV</option>
            <option value="110" >110kV</option>
            <option value="35"  >35kV</option>
            </select>

          

            </select>
            <select style="width:8%" name="county"  id="county" onchange="submitForm();">
            <option value ="">县区</option>
            <option value ="1">清城区</option>
            <option value ="2">清新县</option>
            <option value="3">佛冈县</option>
            <option value="4">英德市</option>
            <option value ="5">阳山县</option>
            <option value ="6">连州市</option>
            <option value ="7">连南县</option>
            <option value="8">连山县</option>
            
            </select>

            <select style="width:8%" name="town"   id="town" onchange="submitForm();">
            <option value ="">镇</option>
            <foreach name="querydata['towns']" item="v">
             <option value ="{$v['id']}">{$v['name']}</option>
            </foreach>
            </select>

            <select style="width:8%" name="village"  id="village" onchange="submitForm();">
            <option value ="">村</option>
            <foreach name="querydata['villages']" item="v">
             <option value ="{$v['id']}">{$v['name']}</option>
             </foreach>
            </select>
            
            截止时间开始<input type="date" value="" name="dead_line_time_begin" id="dead_line_time_begin" onchange="submitForm();">
            截止时间结束<input type="date" value=""  name="dead_line_time_end" id="dead_line_time_end" onchange="submitForm();">

            <select style="width:8%" name="orderBy" id="orderBy" onchange="submitForm();">
            <option value ="">排序方式</option>
            <option value ="danger_degree desc">威胁等级降序</option>
            <option value ="dead_line_time desc">截止时间降序</option>
            <option value ="update_time desc">更新时间降序</option>         
            </select>
           

            <input style="width:6%" class="btn btn-sm btn-success" type="button" onclick="dataFilter(this)" value="数据筛选">
            </form>
          </td>
        </tr>
      </table>
      <!-- <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">

        <li class="active">
        <a href="javascript:;">按钮1</a>
        </li>
        <li>
         <a href="javascript:;">按钮2</a>
        </li>
        <li>
          <a href="javascript:;">按钮3</a>
         </li>
      </ul> -->
      
      
      <div class="tab-content">
       
        <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover table-condensed " id="data-table">
          <tr>
            <th  id="t-tid">编号</th>
            <th  id="t-device_name">线路名称</th>
            <th id="t-star_tower" >起始杆塔</th>
            <th id="t-end_tower">结束杆塔</th>
            <th id="t-county">县</th>
            <th id="t-town">镇</th>
            <th id="t-village">村委会</th>
            <th id="t-owner">拥有者</th>
            <th id="t-owner_phone">拥有者电话</th>
            <th id="t-accountability_department">责任部门</th>
            <th id="t-accountability_group">责任班组</th>                     
            <th id="t-accountability_person">责任人</th>
            <th id="t-site_condition">立地条件</th>
            <th id="t-tree_age">树龄</th>
            <th id="t-tree_status">树木状态</th>
            <th id="t-tree_type">树种</th>
            <th id="t-average_radius">平均胸径</th>
            <th id="t-average_height">平均高度</th>
            <th id="t-first_check_time">首次测量时间</th>
            <th id="t-first_check_method">首次测量方式</th>
            <th id="t-first_check_person">首次测量人</th>
            <th id="t-processed">是否处理</th>
            <th id="t-last_update_time">最近更新时间</th>
            <th id="t.dead_line_time">截止时间</th>
            
           
           


         
           

             
            

            <th width="100px">操作</th>
            
            </tr>
          <foreach name="data" item="v">
            <tr>
              <td>{$v['tid']}</td>
              <td>{$v['voltage_degree']}kV{$v['device_name']}</td>
              <td>{$v['star_tower']}</td>
              <td>{$v['end_tower']}</td>
              <td>{$v['county']}</td>
              <td>{$v['town']}</td>
              <td>{$v['village']}</td>
              <td>{$v['owner']}</td>
              <td>{$v['owner_phone']}</td>
              <td>{$v['accountability_department']}</td>
              <td>{$v['accountability_group']}</td>
              <td>{$v['accountability_person']}</td>
              <td>{$v['site_condition']}</td>
              <td>{$v['tree_age']}</td>
              <td>{$v['tree_status']}</td>
              <td>{$v['tree_type']}</td>
              <td>{$v['average_radius']}</td>
              <td>{$v['average_height']}</td>
              <td>{$v['first_check_time']|date='Y-m-d',###}</td> 
              <td>{$v['first_check_method']}</td>
              <td>{$v['first_check_person']}</td>
              <td>
               <if condition="$v['processed'] eq 'true'">是
              <else /> 否
              </if>
              </td>
              <td>{$v['last_update_time']|date='Y-m-d',###}</td> 
             
              <td>{$v['dead_line_time']|date='Y-m-d',###}</td>  
               
              
     
             

              <td>
              <a href="javascript:;">详情</a>||
              <a href="javascript:;"  tid="{$v['tid']}" onclick="edit_tree(this)">修改</a>||
              <a href="javascript:;"  tid="{$v['tid']}" onclick="delete_tree(this)">删除</a>
              </td>
            </tr>
          </foreach>
        </table>
        <div align="center"> {$pagehtml}</div>
      </div>
       </div>
     
    </div>
  
  </div>
   <div class="modal fade" id="bjy-edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
   data-backdrop="static">
    <div class="modal-dialog">
      <div class="modal-content" id="edit-tree-content" style="width:1200px;height:800px;">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="myModalLabel">数据筛选</h4></div>
        <div class="modal-body" >
          <form id="bjy-form" class="form-inline"  action="{:U('Admin/Nav/edit')}" method="post">
              <p> 
              <input class="" type="checkbox" name="aa">全选
              </p>   
                
            <table class="table table-striped table-bordered table-hover table-condensed" style="width:800px;height:200px;">
              <tr>
              <th>菜单名：</th>
              <th>菜单名：</th>
              <th>菜单名：</th>
              <th>菜单名：</th>
              <th>菜单名：</th>
              <th >菜单名：</th>
              </tr>
              <tr>
              <td>
              <input class="input-medium" type="checkbox" name="aa">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="bb">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="cc">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="dd">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="ee">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="ff">
              </td>
              </tr>
             &nbsp;

              <tr>
              <th>菜单名：</th>
              <th>菜单名：</th>
              <th>菜单名：</th>
              <th>菜单名：</th>
              <th>菜单名：</th>
              <th>菜单名：</th>
              </tr>
              <tr>
              <td>
              <input class="input-medium" type="checkbox" name="aa">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="bb">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="cc">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="dd">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="ee">
              </td>
               <td>
              <input class="input-medium" type="checkbox" name="ff">
              </td>
              </tr>
             
              
          
            </table>
          </form>
        </div>
      </div>
    </div>
  </div> 
</block>



<block name="js">
  
  
  
  
    <script>

    function dataFilter()
    {
      var test='#tid';
       $('#data-table tr').find(test).hide(); 
       //var test=($('#data-table tr').find('#line_name').index());
    //   alert(test);
       $('#data-table tr').find('td:eq(0)').hide();
    }

    function submitForm()
     {
      sessionStorage.setItem("voltage_degree",document.getElementById("voltage_degree").value);
      sessionStorage.setItem("line_id",document.getElementById("line_id").value); 
      sessionStorage.setItem("county",document.getElementById("county").value); 
      sessionStorage.setItem("town",document.getElementById("town").value); 
      sessionStorage.setItem("village",document.getElementById("village").value);  
      sessionStorage.setItem("orderBy",document.getElementById("orderBy").value); 
      sessionStorage.setItem("dead_line_time_begin",document.getElementById("dead_line_time_begin").value); 
      sessionStorage.setItem("dead_line_time_end",document.getElementById("dead_line_time_end").value); 

      var form = document.getElementById("my_form");//获取form表单对象
      form.submit();//form表单提交
     }

       function delete_tree(obj)
     {
       if(confirm('确定删除？'))
       {
           var tid=$(obj).attr('tid');
          
           $.ajax({
           url:'/treesys/index.php/Admin/Line/delete',
           type:'GET', 
           async:true,    
           data:{
              tid:tid
           }})
           submitForm()
       }
     }
     function edit_tree(obj)
     {

         var tid=$(obj).attr('tid');
         document.getElementById("edit-tree-content").style.marginLeft="-50%";
         $('#bjy-edit').modal('show');
     } 

     </script>

    




    <script type="text/javascript">
    $(document).ready(function()
    {
      
      $("#voltage_degree").val(sessionStorage.getItem("voltage_degree"))
      $("#line_id").val(sessionStorage.getItem("line_id"))
      $("#county").val(sessionStorage.getItem("county"))
      $("#town").val(sessionStorage.getItem("town"))
      $("#village").val(sessionStorage.getItem("village"))
      $("#orderBy").val(sessionStorage.getItem("orderBy"))
      $("#dead_line_time_begin").val(sessionStorage.getItem("dead_line_time_begin"))
      $("#dead_line_time_end").val(sessionStorage.getItem("dead_line_time_end"))
      
      
    });   
  </script>
</block>
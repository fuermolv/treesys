

<extend name="Public:base"/><block name="title">树片巡检记录</block>
<block name="content">
<div class="col-xs-12">
    <div class="tabbable">
    <table class="table table-striped table-bordered table-hover table-condensed">

        <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
         <li>
         <a href="/treesys/index.php/Admin/Tree/index/group_id/{$group_id}" >树片列表</a></li>

        <li>  <a href="/treesys/index.php/Admin/Tree/base/group_id/{$group_id}/tid/{$tree_id}" >树片详情</a></li>
        <li>  <a href="/treesys/index.php/Admin/TreeDetail/index/group_id/{$group_id}/tid/{$tree_id}">巡检记录</a></li>
        <li class="active">  <a href="avascript:;" >处理记录</a></li>
           <!-- <li>
          <a href="/treesys/index.php/Admin/Tree/add/group_id/{$group_id}"  >增加树片</a></li> -->
      </ul>
        <tr>
          <td>
            

         <a href="/treesys/index.php/Admin/TreeProcess/index/group_id/{$group_id}/tid/{$tree_id}" style="width:10%" id="list_button" class="btn btn-sm disabled" type="button" tid="{$tree_id}" >处理记录列表</a>
       
         <a href="javascript:;" style="width:10%" id="add_button" class="btn btn-sm btn-success"  type="button" tid="{$tree_id}" onclick="add(this)" >添加新记录</a>
        
       
        <a href="javascript:;"  style="width:10%" id="list_file_button" class="btn btn-sm btn-success" type="button"  tid="{$tree_id}" onclick="file(this)">查看处理文件</a>
        
       
        <a href="javascript:;"  style="width:10%" id="add_file_button" class="btn btn-sm btn-success" type="button" tid="{$tree_id}" onclick="uploadfile(this)">上传处理文件</a>
       
            
               
             <!--    <a href="" style="width:6%" id="list_button" class="btn btn-sm disabled" >巡查记录列表</a>
                <input style="width:6%" id="add_button" class="btn btn-sm btn-success" type="button" tid="{$tree_id}" onclick="add_detail(this)" value="添加新记录"> -->
              
          

        
          </td>
        </tr>
      </table>


<!-- <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
         <li class="active">
         <a href="javascript:;"  tid="{$tree_id}" onclick="process_list(this)" >列表</a></li>
        <li >
        <a href="javascript:;"   tid="{$tree_id}" onclick="add(this)" >添加新记录</a>
        </li>
        <li >
        <a href="javascript:;"   tid="{$tree_id}" onclick="file(this)">查看处理文件</a>
        </li>
        <li >
        <a href="javascript:;"   tid="{$tree_id}" onclick="uploadfile(this)">上传处理文件</a>
        </li>
 </ul> -->


<div class="tab-content" id="tree-process-record">
        <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover table-condensed " id="data-table">
<tr>
  <th colspan="1">隐患单位</th>
  <th  style="text-align:center;" colspan="27">隐患处理与管控（处理过程）</th>
  
</tr>
          <tr>
           <th>记录编号</th>
           <th>计划清理时间</th>
           <th>任务发布时间</th>
           <th>是否额外任务</th>
           <th>属地供电所</th>
           <th>供电所具体工作人员姓名</th>
           <th>供电所具体工作人员联系电话</th>
           <th>输电所分片负责人</th>
           <th>输电所安排的隐患核实工作人员姓名</th>
           <th  >输电所安排的隐患核实工作人员联系电话</th>
           <th  >属地单位计划与户主商谈前的隐患核实时间</th>
            <th  >属地单位与户主商谈前的隐患核实时间</th>
           <th  >属地供单位计划协商的时间段</th>
           <th  >协商过程情况</th>        
           <th  >截止统计日按任务单，现场“隐患核实”情况</th>
           <th  >截止统计日青苗商谈、补偿情况</th>
           <th  >截止统计日存在的协商问题</th>
           <th  >截止统计日砍伐情况</th>
           <!-- 截止统计日砍伐情况 -->
           <th  >是否需逐级上报处理</th>
           <th  >上报级别</th>
           <!-- 最新处理结果1（树桩/根） -->
           <!-- 最新处理结果2 -->
           <!-- 处理人 -->
           <!-- 处理时间(格式：'2013-5-25) -->
           <th  >清障验收时间</th>
           <!-- 验收人 -->
           <th  >验收结论1</th>
           <th  >验收结论2</th>
           <!-- 已有协议情况 -->
           <!-- 已有协议编号 -->
           <th  >输电班组人员确认时间</th>
           <th  >输电班组人员确认签名</th>
            <th  >备注</th>
           <th  >更新人</th>
           <th  >更新时间</th> 
           <th  >操作</th>  
          </tr>
          <foreach name="data" item="v">
            <tr>
            <td id="t-record_id">{$v['record_id']}</td>
            <td id="t-record_plan_clean_time">{$v['record_plan_clean_time']|date='Y-m-d',###}</td>
            <td id="t-record_task_time">{$v['record_task_time']|date='Y-m-d',###}</td>
           
              <td id="t-record_is_additional">
               <if condition="$v['record_is_additional'] eq '1'">是
              <else /> 否
              </if></td>
              <td id="t-record_department">{$v['record_department']}</td>
              <td id="t-record_person">{$v['record_person']}</td>
              <td id="t-record_person_phone">{$v['record_person_phone']}</td>
              <td id="t-record_accountability_person">{$v['record_accountability_person']}</td>
              <td id="t-record_verify_person">{$v['record_verify_person']}</td>
              <td id="t-record_verify_person_phone">{$v['record_verify_person_phone']}</td>

              <td id="t-record_plan_verify_time">{$v['record_plan_verify_time']|date='Y-m-d',###}</td>
              <td id="t-record_verify_time">{$v['record_verify_time']|date='Y-m-d',###}</td>
              <td id="t-record_plan_consult_time">{$v['record_plan_consult_time']}</td>


              <td id="t-record_consult_detail">{$v['record_consult_detail']}</td>

              <td id="t-record_verify_situ">{$v['record_verify_situ']}</td>

              <td id="t-record_verify_consult_situ">{$v['record_verify_consult_situ']}</td>
              <td id="t-record_process_situ">{$v['record_process_situ']}</td>
              
              <td id="t-record_verify_consult_matter">{$v['record_verify_consult_matter']}</td>

               <td id="t-record_need_apper">
               <if condition="$v['record_need_apper'] eq '1'">是
              <else /> 否
              </if></td>
              <td id="t-record_apper_level">{$v['record_apper_level']}</td>

               <td id="t-record_accept_time">{$v['record_accept_time']|date='Y-m-d',###}</td>
                 <td id="t-record_accept_conclusion1">{$v['record_accept_conclusion1']}</td>
              <td id="t-record_accept_conclusion2">{$v['record_accept_conclusion2']}</td>

               <td id="t-record_confirm_time">{$v['record_confirm_time']|date='Y-m-d',###}</td>
               <td id="t-record_confirm_tag">{$v['record_confirm_tag']}</td>

               <td id="t-record_remark">{$v['record_remark']}</td>
               
              <td id="t-record_update_person">{$v['record_update_person']}</td>
              <td id="t-record_update_time">{$v['record_update_time']|date='Y-m-d',###}</td>
         
          
              <td>
              <a href="javascript:;"  tid="{$tree_id}" record_id="{$v['record_id']}" onclick="delete_process(this);">删除</a>
              </td>
            </tr>
          </foreach>
        </table>
        <div align="center"> {$pagehtml}</div>
      </div>
       </div>
    </div>
  </div>



 <script type="text/javascript">


     function delete_process(obj)
     {
      	 if(confirm('确定删除？'))
       {
           
           var record_id=$(obj).attr('record_id');
           
           var tid=$(obj).attr('tid');
          
           $.ajax({
           url:'/treesys/index.php/Admin/TreeProcess/delete',
           type:'GET', 
           async:true,    
           data:{
               record_id:record_id
              
           },
            success:function(msg)
           {

           $.ajax({
          type:"GET",
           url:"/treesys/index.php/Admin/TreeProcess/index",
           data:{
             tid:tid
             },
             success:function(msg)
             {
    
              $("#tree-process-record").html(msg);
            },
           error:function(XMLHttpRequest, textStatus, thrownError){}
          })
                     
            }
         })


       }

     }

    function uploadfile(obj)
    {
       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/treesys/index.php/Admin/TreeProcess/uploadfile",
           data:{
              tid:tid
             },
             success:function(msg){
    
          $("#tree-process-record").html(msg);
       
          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");

          $("#add_button").removeClass("disabled");
          $("#add_button").addClass("btn-success");

          $("#list_file_button").removeClass("disabled");
          $("#list_file_button").addClass("btn-success");

          $("#add_file_button").removeClass("btn-success");
          $("#add_file_button").addClass("disabled");
            },
            error:function(XMLHttpRequest, textStatus, thrownError){}
          })
    }

   function process_list(obj)
    {
       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/treesys/index.php/Admin/TreeProcess/index",
           data:{
              tid:tid
             },
             success:function(msg){
    
          $("#tree-process-record").html(msg);



            },
            error:function(XMLHttpRequest, textStatus, thrownError){}
          })
    }
     function file(obj)
    {
       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/treesys/index.php/Admin/TreeProcess/file",
           data:{
              tid:tid
             },
             success:function(msg){
    
          $("#tree-process-record").html(msg);

          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");

          $("#add_button").removeClass("disabled");
          $("#add_button").addClass("btn-success");

          $("#list_file_button").removeClass("btn-success");
          $("#list_file_button").addClass("disabled");

          $("#add_file_button").removeClass("disabled");
          $("#add_file_button").addClass("btn-success");
            },
            error:function(XMLHttpRequest, textStatus, thrownError){}
          })
    }
     function add(obj)
    {
       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/treesys/index.php/Admin/TreeProcess/add",
           data:{
              tid:tid
             },
             success:function(msg){
    
          $("#tree-process-record").html(msg);
           $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");
          $("#add_button").removeClass("btn-success");
          $("#add_button").addClass("disabled");
          $("#list_file_button").removeClass("disabled");
          $("#list_file_button").addClass("btn-success");
          $("#add_file_button").removeClass("disabled");
          $("#add_file_button").addClass("btn-success");
            },
            error:function(XMLHttpRequest, textStatus, thrownError){}
          })
    }




 </script>
 </block>
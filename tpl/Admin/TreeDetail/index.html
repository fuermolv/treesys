<extend name="Public:base"/><block name="title">树障巡检记录</block>
<block name="content">
<div class="col-xs-12">
    <div class="tabbable">
    <table class="table table-striped table-bordered table-hover table-condensed">

        <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
         <li >
         <a href="/ts/index.php/Admin/Tree/index" >树障列表</a></li>

        <li>  <a href="/ts/index.php/Admin/Tree/base/tid/{$tree_id}" >树障详情</a></li>
        <li class="active">  <a href="javascript:;"    data-toggle="tab">巡检记录</a></li>
        <li>  <a href="/ts/index.php/Admin/TreeProcess/index/tid/{$tree_id}" >处理记录</a></li>
        <!-- <li>  <a href="/ts/index.php/Admin/TreeFly/index/group_id/{$group_id}/tid/{$tree_id}">飞行记录</a></li> -->
        
        <!-- <li>
          <a href="/ts/index.php/Admin/Tree/add/group_id/{$group_id}"  >增加树障</a></li> -->
      </ul>
        <tr>
          <td>
            
            
               
                <a href="" style="width:10%" id="list_button" class="btn btn-sm disabled" >巡查记录列表</a>
               <!--  <input style="width:10%" id="add_button" class="btn btn-sm btn-success" type="button" tid="{$tree_id}" onclick="add_detail(this)" value="添加新记录"> -->

               <a href="javascript:;"  style="width:10%" id="list_file_button" class="btn btn-sm btn-success" type="button"  tid="{$tree_id}" onclick="file(this)">查看巡查文件</a>
        
       
               <a href="javascript:;"  style="width:10%" id="add_file_button" class="btn btn-sm btn-success" type="button" tid="{$tree_id}" onclick="uploadfile(this)">上传巡查文件</a>
              
          

        
          </td>
        </tr>
      </table>


   <!--  <div class="modal fade" id="bjy-edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="myModalLabel">初始化任务单流程</h4></div>
        <div class="modal-body">
          <form id="bjy-form" class="form-inline" action="{:U('Admin/TreeOrder/order_edit')}" method="post">
            <input type="hidden" name="tid">
            <input type="hidden" name="order_file_id">
            <table class="table table-striped table-bordered table-hover table-condensed">
              <tr>
                <th width="20%">备注/批示(必填)</th>
                <td>
                 <input style="width:80%;"  name="order_remark" />
                </td>
              </tr>

               <tr>
                <th width="20%">树障流程(选填)</th>
                <td>
                 <input style="width:80%;"  name="order_div" />
                </td>
              </tr>

              <tr>
                <th width="20%">属地局</th>
                <td>
                  <input  list="datalist" placeholder="属地局名称" type="text" style="width: 80%;" name="order_local_department" id="order_local_department" /> 
                      <datalist id="datalist">
                      <foreach name="local_department" item="v">
                      <option value ="{$v['department_name']}"></option>
                    </foreach>
                </td>
              </tr>

             
              <tr>
                <th></th>
                <td>
                  <input class="btn btn-success" type="submit" value="确定"></td>
              </tr>
            </table>
          </form>
        </div>
      </div>
    </div>
  </div> -->

<!-- <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
        <li class="active">
          <a href="javascript:;" data-toggle="tab">列表</a></li>
        <li>
          <a href="javascript:;" tid="{$tree_id}" onclick="add_detail(this)" ">添加新记录</a></li>
       </ul> -->

  <div class="tab-content" id="tree-deatil-record">
        <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover table-condensed " id="data-table">
<tr>
    <th colspan="4">树障总体情况</th>    
    <th colspan="6">树障数据</th>
    <th colspan="3">系统记录</th>
    <th colspan="1">操作</th>                     
          
    
</tr>
          <tr> 
          <th  >隐患调查时间</th>    
          <th  >隐患等级</th>
          <th  >倒伏等级</th>  
          <th  >隐患等级变化</th>   

             <th  >飞行高度</th>
           <th >树高</th>
           <th >水平距离</th>
           <th >垂直距离</th>
           <th >净空距离</th>
           <th >安全距离</th>   
         
         
           <th >更新时间</th>
           <th >更新人</th> 
           <th >是否最新</th>
           
           <th>操作</th>  
          </tr>
          <foreach name="data" item="v">
            <tr>
              <td id="t-detail_last_time">{$v['detail_last_time']|date='Y-m-d',###}</td>
              <td  >{$v['datail_danger_degree']}</td>    
              <td  >{$v['datail_lodging_degree']}</td>                    
              <td  >{$v['datail_check_change_conclusion']}</td>

              <td  >{$v['detail_fly_height']}</td>                        
               <td  >{$v['datail_tree_height']}</td>
              <td  >{$v['datail_tree_horizontal']}</td>
              <td  >{$v['datail_tree_vertical']}</td>
              <td  >{$v['datail_mix_net_distance']}</td>
              <td  >{$v['detail_safe_distance']}</td>                 
             
              <td  id="t-datail_update_time">{$v['datail_update_time']|date='Y-m-d',###}</td>
              <td  id="t-datail_update_person">{$v['datail_update_person']}</td> 
              

              <td id="t-datail_uptodate">
                <if condition="$v['datail_uptodate'] eq '1'">是
              <else /> 否
              </if></td>
              </td>       
        

              <td>
              <a href="javascript:;" tid="{$tree_id}" detail_id="{$v['detail_id']}" onclick="delete_detail(this);">删除</a>
            
              </td>
            </tr>
          </foreach>
        </table>
        <div align="center"> {$pagehtml}</div>
      </div>
       </div>
    </div>
  </div>


 <script type="text/javascript">
  function delete_detail(obj)
     {
       if(confirm('确定删除？'))
       {
           var detail_id=$(obj).attr('detail_id');
           var tid=$(obj).attr('tid');
          
           $.ajax({
           url:'/ts/index.php/Admin/TreeDetail/delete',
           type:'GET', 
           async:true,    
           data:{
              detail_id:detail_id,
              tid:tid
           },
            success:function(msg)
           {
             //alert(msg);          
            }
         })

          $.ajax({
          type:"GET",
           url:"/ts/index.php/Admin/TreeDetail/index",
           data:{
             tid:tid
             },
             success:function(msg){
            // $("#tree-deatil-record").html(msg);
             window.location.reload();

            },
           error:function(XMLHttpRequest, textStatus, thrownError){}
          })
       }

     }
    function add_detail(obj)
    {

       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/ts/index.php/Admin/TreeDetail/add",
           data:{
              tid:tid
             },
             success:function(msg){
    
          $("#tree-deatil-record").html(msg);
          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");
          $("#add_button").removeClass("btn-success");
          $("#add_button").addClass("disabled");
          $("#list_file_button").removeClass("disabled");
          $("#list_file_button").addClass("btn-success");
          $("#add_file_button").removeClass("disabled");
          $("#add_file_button").addClass("btn-success");
          
            },
            error:function(XMLHttpRequest, textStatus, thrownError){}
          })
    }

    function uploadfile(obj)
    {
       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/ts/index.php/Admin/TreeDetail/uploadfile",
           data:{
              tid:tid
             },
             success:function(msg){

    
     
          $("#tree-deatil-record").html(msg);
              
          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");

          $("#add_button").removeClass("disabled");
          $("#add_button").addClass("btn-success");

          $("#list_file_button").removeClass("disabled");
          $("#list_file_button").addClass("btn-success");

          $("#add_file_button").removeClass("btn-success");
          $("#add_file_button").addClass("disabled");
       
            },
            error:function(XMLHttpRequest, textStatus, thrownError){}
          })
    }

     function file(obj)
    {
       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/ts/index.php/Admin/TreeDetail/file",
           data:{
              tid:tid
             },
             success:function(msg){
    
         
         
          $("#tree-deatil-record").html(msg);
          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");

          $("#add_button").removeClass("disabled");
          $("#add_button").addClass("btn-success");

          $("#list_file_button").removeClass("btn-success");
          $("#list_file_button").addClass("disabled");

          $("#add_file_button").removeClass("disabled");
          $("#add_file_button").addClass("btn-success");
            },
            error:function(XMLHttpRequest, textStatus, thrownError){
              
            }

          })
    }

     function init_order(obj)
 {
      var file_id = $(obj).attr('file_id');
      var tid = $(obj).attr('tid');


    
      $("input[name='order_file_id']").val(file_id);
      $("input[name='tid']").val(tid);
    
      $('#bjy-edit').modal('show');
 }


</script>
</block>
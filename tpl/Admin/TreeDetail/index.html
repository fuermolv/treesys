<extend name="Public:base"/><block name="title">树障巡检记录</block>
<block name="content">
<div class="col-xs-12">
    <div class="tabbable">
    <table class="table table-striped table-bordered table-hover table-condensed">

        <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
         <li >
         <a href="/ts/index.php/Admin/Tree/index" >树障列表</a></li>

        <li>  <a href="/ts/index.php/Admin/Tree/base/tid/{$tree_id}" >树障详情</a></li>
        <li class="active">  <a href="javascript:;"    data-toggle="tab">巡检记录</a></li>
        <li>  <a href="/ts/index.php/Admin/TreeProcess/index/tid/{$tree_id}" >处理记录</a></li>
        <!-- <li>  <a href="/ts/index.php/Admin/TreeFly/index/group_id/{$group_id}/tid/{$tree_id}">飞行记录</a></li> -->
        
        <!-- <li>
          <a href="/ts/index.php/Admin/Tree/add/group_id/{$group_id}"  >增加树障</a></li> -->
      </ul>
        <tr>
          <td>
            
            
               
                <a href="" style="width:10%" id="list_button" class="btn btn-sm disabled" >巡查记录列表</a>
               <!--  <input style="width:10%" id="add_button" class="btn btn-sm btn-success" type="button" tid="{$tree_id}" onclick="add_detail(this)" value="添加新记录"> -->

               <a href="javascript:;"  style="width:10%" id="list_file_button" class="btn btn-sm btn-success" type="button"  tid="{$tree_id}" onclick="file(this)">查看任务单</a>
        
       
               <a href="javascript:;"  style="width:10%" id="add_file_button" class="btn btn-sm btn-success" type="button" tid="{$tree_id}" onclick="uploadfile(this)">上传任务单</a>
              
          

        
          </td>
        </tr>
      </table>


    <div class="modal fade" id="bjy-edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="myModalLabel">初始化任务单流程</h4></div>
        <div class="modal-body">
          <form id="bjy-form" class="form-inline" action="{:U('Admin/TreeOrder/order_edit')}" method="post">
            <input type="hidden" name="tid">
            <input type="hidden" name="order_file_id">
            <table class="table table-striped table-bordered table-hover table-condensed">
              <tr>
                <th width="20%">备注(必填)</th>
                <td>
                 <input style="width:80%;"  name="order_remark" />
                </td>
              </tr>

               <tr>
                <th width="20%">当前状态(选填)</th>
                <td>
                 <input style="width:80%;"  name="order_div" />
                </td>
              </tr>

              <tr>
                <th width="20%">属地局</th>
                <td>
                  <input  list="datalist" placeholder="属地局名称" type="text" style="width: 80%;" name="order_local_department" id="order_local_department" /> 
                      <datalist id="datalist">
                      <foreach name="local_department" item="v">
                      <option value ="{$v['department_name']}"></option>
                    </foreach>
                </td>
              </tr>

             
              <tr>
                <th></th>
                <td>
                  <input class="btn btn-success" type="submit" value="确定"></td>
              </tr>
            </table>
          </form>
        </div>
      </div>
    </div>
  </div>

<!-- <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
        <li class="active">
          <a href="javascript:;" data-toggle="tab">列表</a></li>
        <li>
          <a href="javascript:;" tid="{$tree_id}" onclick="add_detail(this)" ">添加新记录</a></li>
       </ul> -->

  <div class="tab-content" id="tree-deatil-record">
        <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover table-condensed " id="data-table">
<tr>
    <th colspan="3">隐患最新情况</th>    
    <th colspan="3">隐患最新情况（程度）</th>
    <th colspan="1">隐患最新情况（位置）</th>                    
    <th colspan="14">隐患最新情况（表象）</th>
    <th colspan="1">隐患最新情况（监测）</th>
    <th colspan="1">隐患来源</th>
    <th colspan="4">隐患权属人信息</th>
    <th colspan="5">隐患处理与管控</th>
    <th colspan="5">系统新增</th>                
    
</tr>
          <tr> 
          <th  id="t-detail_last_time">最新隐患调查日）</th>    
           <th  id="t-datail_check_person">最新隐患调查）</th> 
           <th  id="t-datail_check_time">测量时刻</th>      
           <th  id="t-datail_danger_degree">隐患级别（最新隐患）</th>
           <th  id="t-datail_check_change_conclusion">调缺陷级别变化</th>
           <th  id="t-datail_check_process_conclusion">处理结论</th>
           <th  id="t-datail_check_posistion_conclusion">位置结论(位置)</th>           
           <th  id="t-datail_tree_type">最危急树障种类</th>
           <th  id="t-datail_tree_num">最危急树障数量</th>
           <th  id="t-datail_tree_num_unit">最危急树障数量单位</th>
           <th  id="t-datail_tree_area">最危急树障面积</th>
           <th  id="t-datail_tree_area_unit">最危急树障面积单位</th>
           <th  id="t-datail_tree_height">最危急树障树高</th>           
           <th  id="t-datail_tree_horizontal">最危急树障导线对树木水平距离</th>
           <th  id="t-datail_tree_vertical">最危急树障导线对树木垂直距离</th>
           <th  id="t-datail_tree_grand_height">最危急树障导线对地</th>

           <th  id="t-datail_mix_net_distance">最小净空距离</th>
           <th  id="t-datail_mix_lodging_distance">树木倒伏导线最小距离</th>
           <th  id="t-datail_lodging_degree">倒伏判断隐患级别</th>

           <th  id="t-datail_tree_over">是否高出导线</th>
           <th  id="t-datail_final_danger">最终自然生长高度是否构成一般级别缺陷</th>           
           <th  id="t-detail_check_method">测量方法</th>                      
         <!--   <th  id="t-detail_temperature">气温（℃）</th>
           <th  id="t-detail_load">负荷（A）</th> -->
           <th  id="t-detail_retain">是否建设遗留</th>
           <th  id="t-detail_address">种植物联系人地址</th>
           <th  id="t-detail_owner">种植物联系人姓名</th>
           <th  id="t-detail_phone">种植物联系人电话</th>
           <th  id="t-detail_plant_time">种植时间</th>
           <th  id="t-detail_compensation_condition">青赔情况</th>
           <th  id="t-detail_build_deal">线路建设协议签定情况</th>
           <th  id="t-detail_run_deal">运行过程中协议情况</th>
           <th  id="t-detail_notice_number">隐患通知书编号、情况</th>
            <th  id="t-detail_order_time">任务单发布时间</th>
         
           <th id="t-datail_update_time">更新时间</th>
           <th id="t-datail_update_person">更新人</th> 
           <th  id="t-datail_update_group">更新班组</th>
           <th  id="t-datail_uptodate">是否最新</th>
           
           <th>操作</th>  
          </tr>
          <foreach name="data" item="v">
            <tr>
              <td id="t-detail_last_time">{$v['detail_last_time']|date='Y-m-d',###}</td>                 
              <td id="t-datail_check_person">{$v['datail_check_person']}</td>              
              <td id="t-datail_check_time">{$v['datail_check_time']|date='Y-m-d H:i:s',###}</td>
              <td id="t-datail_danger_degree">{$v['datail_danger_degree']}</td>
              <td id="t-datail_check_change_conclusion">{$v['datail_check_change_conclusion']}</td>
              <td id="t-datail_check_process_conclusion">{$v['datail_check_process_conclusion']}</td>
              <td id="t-datail_check_posistion_conclusion">{$v['datail_check_posistion_conclusion']}</td>
              <td id="t-datail_tree_type">{$v['datail_tree_type']}</td>
              <td id="t-datail_tree_num">{$v['datail_tree_num']}</td>
              <td id="t-datail_tree_num_unit">{$v['datail_tree_num_unit']}</td>
              <td id="t-datail_tree_area">{$v['datail_tree_area']}</td>
              <td id="t-datail_tree_area_unit">{$v['datail_tree_area_unit']}</td>
              <td id="t-datail_tree_height">{$v['datail_tree_height']}</td>              
              <td id="t-datail_tree_horizontal">{$v['datail_tree_horizontal']}</td>
              <td id="t-datail_tree_vertical">{$v['datail_tree_vertical']}</td>
              <td id="t-datail_tree_grand_height">{$v['datail_tree_grand_height']}</td>
              
              <td id="t-datail_mix_net_distance">{$v['datail_mix_net_distance']}</td>
              <td id="t-datail_mix_lodging_distance">{$v['datail_mix_lodging_distance']}</td>
              <td id="t-datail_lodging_degree">{$v['datail_lodging_degree']}</td>


              <td id="t-datail_tree_over">
                <if condition="$v['datail_tree_over'] eq 1">是
              <else /> 否
              </if></td>

              <!-- <td id="t-datail_tree_over">
                <if condition="$v['datail_tree_over'] eq 1">是
              <else /> 否
              </if></td>
              </td>  -->
              <!-- 不知道如何多了一个值，之前检查的时候是没有的 -->
              <td id="t-datail_final_danger">
                <if condition="$v['datail_final_danger'] eq 1">是
               <else /> 否
               </if></td>
              <td id="t-detail_check_method">{$v['detail_check_method']}</td>              
            <!--   <td id="t-detail_temperature">{$v['detail_temperature']}</td>
              <td id="t-detail_load">{$v['detail_load']}</td> -->
              <td id="t-detail_retain">
                  <if condition="$v['detail_retain'] eq 1">是
                <else /> 否
                </if></td>
                </td> 
              <td id="t-detail_address">{$v['detail_address']}</td>
              <td id="t-detail_owner">{$v['detail_owner']}</td>
              <td id="t-detail_phone">{$v['detail_phone']}</td>
              <td id="t-detail_plant_time">{$v['detail_plant_time']}</td>
              <td id="t-detail_compensation_condition">{$v['detail_compensation_condition']}</td>
              <td id="t-detail_build_deal">{$v['detail_build_deal']}</td>
              <td id="t-detail_run_deal">{$v['detail_run_deal']}</td>
              <td id="t-detail_notice_number">{$v['detail_notice_number']}</td>
               <td id="t-detail_order_time">{$v['detail_order_time']}</td>

              
              

              <td  id="t-datail_update_time">{$v['datail_update_time']|date='Y-m-d',###}</td>
              <td  id="t-datail_update_person">{$v['datail_update_person']}</td> 
              <td id="t-datail_update_group">{$v['datail_update_group']}</td>

              <td id="t-datail_uptodate">
                <if condition="$v['datail_uptodate'] eq '1'">是
              <else /> 否
              </if></td>
              </td>       
        

              <td>
              <a href="javascript:;" tid="{$tree_id}" detail_id="{$v['detail_id']}" onclick="delete_detail(this);">删除</a>
            
              </td>
            </tr>
          </foreach>
        </table>
        <div align="center"> {$pagehtml}</div>
      </div>
       </div>
    </div>
  </div>


 <script type="text/javascript">
  function delete_detail(obj)
     {
       if(confirm('确定删除？'))
       {
           var detail_id=$(obj).attr('detail_id');
           var tid=$(obj).attr('tid');
          
           $.ajax({
           url:'/ts/index.php/Admin/TreeDetail/delete',
           type:'GET', 
           async:true,    
           data:{
              detail_id:detail_id,
              tid:tid
           },
            success:function(msg)
           {
             //alert(msg);          
            }
         })

          $.ajax({
          type:"GET",
           url:"/ts/index.php/Admin/TreeDetail/index",
           data:{
             tid:tid
             },
             success:function(msg){
            // $("#tree-deatil-record").html(msg);
             window.location.reload();

            },
           error:function(XMLHttpRequest, textStatus, thrownError){}
          })
       }

     }
    function add_detail(obj)
    {

       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/ts/index.php/Admin/TreeDetail/add",
           data:{
              tid:tid
             },
             success:function(msg){
    
          $("#tree-deatil-record").html(msg);
          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");
          $("#add_button").removeClass("btn-success");
          $("#add_button").addClass("disabled");
          $("#list_file_button").removeClass("disabled");
          $("#list_file_button").addClass("btn-success");
          $("#add_file_button").removeClass("disabled");
          $("#add_file_button").addClass("btn-success");
          
            },
            error:function(XMLHttpRequest, textStatus, thrownError){}
          })
    }

    function uploadfile(obj)
    {
       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/ts/index.php/Admin/TreeDetail/uploadfile",
           data:{
              tid:tid
             },
             success:function(msg){

    
     
          $("#tree-deatil-record").html(msg);
              
          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");

          $("#add_button").removeClass("disabled");
          $("#add_button").addClass("btn-success");

          $("#list_file_button").removeClass("disabled");
          $("#list_file_button").addClass("btn-success");

          $("#add_file_button").removeClass("btn-success");
          $("#add_file_button").addClass("disabled");
       
            },
            error:function(XMLHttpRequest, textStatus, thrownError){}
          })
    }

     function file(obj)
    {
       var tid=$(obj).attr('tid');
        $.ajax({
          type:"GET",
           url:"/ts/index.php/Admin/TreeDetail/file",
           data:{
              tid:tid
             },
             success:function(msg){
    
         
         
          $("#tree-deatil-record").html(msg);
          $("#list_button").removeClass("disabled");
          $("#list_button").addClass("btn-success");

          $("#add_button").removeClass("disabled");
          $("#add_button").addClass("btn-success");

          $("#list_file_button").removeClass("btn-success");
          $("#list_file_button").addClass("disabled");

          $("#add_file_button").removeClass("disabled");
          $("#add_file_button").addClass("btn-success");
            },
            error:function(XMLHttpRequest, textStatus, thrownError){
              
            }

          })
    }

     function init_order(obj)
 {
      var file_id = $(obj).attr('file_id');
      var tid = $(obj).attr('tid');


    
      $("input[name='order_file_id']").val(file_id);
      $("input[name='tid']").val(tid);
    
      $('#bjy-edit').modal('show');
 }


</script>
</block>